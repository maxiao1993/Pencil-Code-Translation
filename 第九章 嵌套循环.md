# 第九章 嵌套循环
### 9.0.1 教学目标
这一章有两个目的。第一个目的是介绍嵌套循环的概念和向学生展示如何构建他们。这节课使用ASCII艺术来教学嵌套循环。第二个目的是介绍二维输出网格系统的概念。使用嵌套循环来遍历一个二维网格是最常规的方法。这使得嵌套循环对于学生来说是一个需要学习和掌握的有力的结构思想.

### 9.0.2 大纲
##### 9.0 本章介绍
	9.0.1 教学目标
	9.0.2 大纲
	9.0.3 关键术语
	9.0.4 关键概念
##### 9.1 教案
	9.1.1 教学建议
	9.1.2 推荐日程
	9.1.3 CSTA标准
	9.1.4 教学计划I:使用易理解的嵌套循环
	9.1.5 教学计划II:遍历二维网格来构建ASCII艺术



###9.0.3 关键术语
<table>
<tr>
<td>Index</td>
<td>Tables</td>
</tr>
<tr>
<td>Matrix</td>
<td>ASCII Art</td>
</tr>
<tr>
<td>Nesting</td>
<td>Tracing</td>
</tr>
<tr>
<td>Animation</td>
<td>Inner and outer loop</td>
</tr>
</table>


###9.0.4 关键概念
当循环嵌套在循环中，一个程序可以创建一个重复的重复。下面是一个例子.
<table>
<tr>
<td>
<pre>
for (var j = 0; j < 5; ++j) {
    for (var k = 0; k < 8; ++k) {
	typebox(random(color));
	}
	typeline();
}
</pre>
</td>
<td>输出:
    <br><img src='images/9/1.jpg'></td>
</tr>
</table>


#####内循环和外循环

 当使用嵌套循环时，内外循环扮演着不同的角色：

* 
外循环是先开始后结束的运行顺序。它在程序运行中开始一次结束一次。在上面的实例中，外循环使用的变量使其重复五次去运行内循环，然后在每次在每一行结尾的输出后,做一个typeline,做整整5次.

* 
内循环是比外循环后开始先结束的运行。它可以反复地重复运行。在这里,内循环循环5次，每次K从0开始计数到8，做8次typebox。当程序完成时，内循环将重复5x8=40次。

内循环快速运行，每一次外循环,都会完成一个完整的内循环。外循环循环的偏慢。

内部和外部的循环类似时钟指针的运转。例如，一个时钟的秒针就像内部循环同时分针就像外循环.对于每一次分针的转动,秒针都需要转一圈,转动60整秒.当分针转动一整个小时时,秒针将转动60*60 = 3600秒.

里程表和日历的都是用这样相似的工作方式。

#####非独立的内循环

有时，内部循环的工作方式取决于外部循环的哪一步运行。例如，创建一个程序打印在一年中所有的日期，您可以使用嵌套循环去打印月份的每天，但内部循环的次数取决于外部循环，这是因为每个月有不同的天数。

<pre>
lengths = [31, 27, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
for (var month = 0; month < 12; month++) {
	for (var day = 0; day < lengths[month]; day++) {
	write((month + 1) + "/" + (day + 1));
	}
}
                  //一个打印一年中每一天日期的嵌套循环
</pre>
                  
                  

在这里，内部循环重复的是不同的次数，这取决于它在哪个月份上，因为它的结束条件是 day < lengths[month]。

对于月份，我们绘制了一个依赖于存放每一月的天数的数组的内循环,但是对于给一个非独立内循环构思一个规则需要更加的泛化:这样一个程序员需要考虑使用的特殊情况,同时要尝试泛化这个规则.


#####泛化一个内部循环的规则

假设我们创建一个类似于下面图案形式的一个程序。
<table>
<tr>
<td>
<pre>N = 5
for (var row = 0; row < N; row++) {
	for (var b = 0; b < ??; b++) {
		typebox(blue);
	}
	for (var j = 0; j < ??; j++) {
		typebox(orange);
	}
	typeline();
}</pre>
</td>
<td>预期输出：<br><img src='images/9/2.jpg'></td>
</tr>
</table>


                        规划一个非独立内循环时:我们如何选择红色的循环边界？

我们想要的输出是一个带颜色的5x5分布的方格，但是我们想泛化我们的程序以至于这个程序可以形成任意大小、相似的图案。每一行都有一定数量的蓝色方格，后面是一定数量的橘黄色的方格，我们可以使用一个类似右边的嵌套循环程序，用一个外部循环来规定一行，用两个内部循环，一个内部训练对应蓝色方格，一个内部循环对应橘黄色方格。

需要放入的值是由问题决定的，这使得程序需要泛型化。我们可以通过一些特殊输出查找图案规律来达到这一点。下面是一个总结了每一行的图形的表格。
<br>

<table>
	<tr>
		<td>行数</td> 
		<td>蓝色方格数目</td>
        <td>橘色方格数目</td>
        <td>蓝色方格的公式</td>
        <td>橘色方格的公式</td>
	</tr>
	<tr>
		<td>row = 0</td>
		<td>4</td>
        <td>1</td>
        <td>4 = N - 1 - row</td>
        <td>1 = row + 1</td>
	<tr>
		<td>row = 1</td>
		<td>3</td>
        <td>2</td>
        <td>3 = N - 1 - row</td>
        <td>2 = row + 1</td>
	</tr>
	<tr>
		<td>row = 2</td>
		<td>2</td>
        <td>3</td>
        <td>2 = N - 1 - row</td>
        <td>3 = row + 1</td>
	</tr>
    <tr>
        <td>row = 3</td>
        <td>1</td>
        <td>4</td>
        <td>1 = N - 1 - row</td>
        <td>4 = row + 1</td>
    </tr>
    <tr>
        <td>row = 4</td>
        <td>0</td>
        <td>5</td>
        <td>0 = N - 1 - row</td>
        <td>5 = row + 1</td>
    </tr>
</table>

<br>
你可以通过寻找例子的形状和计数来填充表格的前三列。但为了归纳，你需要找到最后两列中存在的规律。这需要找到一条一行中的方格的数目和行数之间的关系。例如，橘色方格的数量在每行总是比行数多一个。因此，橘色方格数目的公式都是 行数+ 1。

对于蓝色方格，行数每增加一个，方格就减少一个，所以规则应该使用减法。在这个例子中，适用的公式是 4-行数。但是这个并不是很规律。想象一个更大的10x10的图案，N = 10. 在这种情况下，在第0行的蓝色的数目将不会是4,它将会会是9！因此，一个完全的广义公式N - 1 - row 适用于任何一个大小N的任意一行。

填充在公式中的两个内部循环的条件 b < row + 1 和 j < N - 1 - row 将使程序适用于任何一个N。

由于内部循环和外部循环的关系，嵌套循环可以使具有挑战性的程序正确。设计嵌套循环的一个很好的策略是在一个例子中仔细地找出你想要的运行效果，然后找到一个方法来归纳它。


###9.1.1 教学建议
下面的课程计划是结构化的以便于让学生掌握嵌套循环的思想。鼓励学生在遍历的过程中追踪值，然后引入二维网格的思想。确保Pencil Code一直处于JavaScript代码模式。尽可能多地鼓励学生在文本模式下将他们的代码成型。他们可以切换到模块模式（在需要时），然后把模块放到程序中。


###9.1.2 推荐时间安排 (55分钟的课堂时间)

<table>
	<tr>
		<td>教学日</td> 
		<td>建议</td>
	</tr>
	<tr>
		<td>第一天</td>
		<td>教学计划I</td>
	<tr>
		<td>第二天</td>
		<td>教学计划II</td>
	</tr>
</table>

###9.1.3 CSTA标准

<table>
	<tr>
		<td>CSTA标准</td> 
		<td>CSTA链</td>
		<td>CSTA覆盖的学习目标</td>
	</tr>
	<tr>
		<td>等级3 B<br>（等级9-12）</td>
		<td>协作（CL）</td>
		<td>使用项目协作工具，版本控制系统，集成开发环境（IDE），协同软件项目工作。</td>
	<tr>
		<td>等级3 A<br>（等级9-12）</td>
		<td>计算思维（CT）</td>
		<td>解释如何序列，选择，迭代和递归去构建块的算法。</td>
	</tr>
</table>


###9.1.5 教学计划I
本课介绍嵌套循环。这有两个程序。这里展示了二种不同的教学工具。第一个是显示程序的逻辑运行路径，追踪代码。播放视频演示给学生循环是如何执行发生。第二个是对代码修改提出简单的问题，阐述每一行代码的作用。在进行其他概念教学时可能应该采取的两种思想。

<table>
<tr>
<td  style="width:350px;">具体内容</td>
<td>教学建议</td>
<td>时间</td>
</tr>
<tr>
<td>代码:<pre>speed(100);
for (var i = 0; i < 10; ++i) {
  for (var j = 0; j < 19; ++j) {
    typebox(purple);
  }
  typeline();
}
</pre>
输出：<br><img src='images/9/3.jpg'>
</td>
<td>使用在最左边一列中提供的代码。
<br>转换到Text-mode
<br>运行程序同时阐述嵌套循环是怎么样运行的。
<br>运行程序同时展示外部循环的每一个迭代和内部循环是怎么完成每一个迭代。</td>
<td>阐述时间：30分钟</td>
</tr>
<tr>
<td>代码：<br><pre>speed(1);
pen(purple, 1);
for (var i = 0; i < 10; ++i){
  dot(blue, 10);
  for (var j = 0; j < 4; ++j){
    fd(50);
    rt(90);
  }
  lt(36);
  bk(50);
}
</pre>
输出：<br><img src='images/9/4.jpg'></td>
<td>让学生优化装饰巢程序。
<br>鼓励学生处在Text-mode。当他们在显示器上看这个程序的时候，要求学生回答以下问题。
<br>（问题可以是被投影，或者写上白板，或者作为一个需要上交的填写作业）
<br>a.创造了什么内部循环？
<br>b.创造了多少蓝方格？
<br>c.lt和bk指令是作为哪个循环的一部分？
<br>d.他们得到多少次执行？
<br>e.当内部迭代增加时发生了什么？
<br><br>给学生五分钟左右回答问题，然后，作为一个大的分组讨论学生分享他们的答案。（另外，这可以作为一个作业或明天的一个热身）</td>
<td>阐述时间：30分钟</td>
</tr>
</table>

<table>
<tr>
<td>给学生五分钟左右回答问题，然后，作为一个大的分组讨论学生分享他们的答案。（另外，这可以作为一个作业或明天的一个热身）
<br><br>作为一个嵌套装饰程序的拓展，要求学生将这个程序修改'for'循环，例如使用额外的FD和RT指令来创建有趣的图案。
<br>教学提示：给予在课上提交最有创意项目的学生奖励额外分数。
<br>学生练习：55分钟</td>
</tr>
</table>



			
			
###9.1.5 教学计划II
本课程着重于利用嵌套循环构建一个简单的二维输出图像。它是有趣和丰富多彩的创建ASCII文本艺术的敲门砖。

<table>
<tr>
<td style="width:350px;">具体内容</td>
<td>教学建议</td>
<td>时间</td>
</tr>
<tr>
<td>代码:<br><img src='images/9/5.jpg'>
<br><pre>speed(10);
for (var i = 0; i < 3; ++i) {
  for (var j = 0; j < 3; ++j) {
    typebox(random(color));
  }
  typeline();
}
</pre>
</td>
<td>把最左边一列程序给学生。让他们在text和block之间切换来理解程序的逻辑。
<br>要求他们使用这些可能的变量来修改程序，如：
<br>  o 迭代的数字 i 和 j 
<br>  o 颜色-不变化的颜色
<br>
<br>问他们如果迭代数字j和i不一样的话会发生什么？
<br>输出：<br><img src='images/9/6.jpg'></td>
<td>阐述时间：20分钟</td>
</tr>
<tr>
<td>代码：<br><pre>speed(500);
for (var i = 0; i < 10; ++i) {
  for (var j = 0; j < 9-i; ++j)
  {
    typebox(transparent);
  }
  for (var j = 0; j < 1+i*2;++j) {
    typebox(darkgreen);
  }
  typeline();
}
</pre></td>
<td>让学生使用最左边一列中的代码去设计一个三角形。
<br>然后，给学生展示如何使用typebox()去绘制一个typeline()单元，使他们可以创造ASCII/TEXT艺术设计。
<br>（如果需要的话，学生可以在Text和Block中切换思维）
<br>输出：<br><img src='images/9/7.jpg'></td>
<td>阐述时间：30分钟</td>
</tr>
<tr>
<td>代码：<br><pre>speed(500);
dot(deepskyblue, 5000);
moveto(6, 70);
for (var i = 0; i < 10; ++i) {
  for (var j = 0; j < 9-i; ++j){
    typebox(transparent);
  }
  for (var j = 0; j < 1+i*2;++j) {
    typebox(darkgreen);
  }
  typeline();
}
jumpxy(4,250);
for (var i = 0; i < 3; ++i) {
  for (var j = 0; j < 12; ++j){
  if (j < 7) {
    typebox(transparent);
  } else {
  typebox(brown);
    }
  }
  typeline();
}
</pre></td>
<td>在课上使用这两种被构建出的艺术形状，让学生用ASCII艺术构建一个类似于最左边一列中展示的有趣的图像。
<br>下面这个是一个程序例子
<br>输出：<br><img src='images/9/8.jpg'></td>
<td>阐述时间：55分钟
<br>学生练习时间：100分钟</td>
</tr>
</table>

###9.2 资源
#####额外练习:
使用文字艺术让学生合作建立一个长期的项目。最后的结果应该是使用至少2个对象建立一个有趣的文字艺术场景。允许学生去使用其他章节库函数中的对象。要求每个学生至少应该独立创建一个文本艺术，同时要求他们提交自己的作品，因为这将作为等级的一个早期成品评价。（你可以选择这个等级是整体等级的一部分或一个单独个人的成绩。）
